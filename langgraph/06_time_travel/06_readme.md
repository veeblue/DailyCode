# LangGraphèŠå¤©æœºå™¨äººå®ç°ç¬”è®°

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºLangGraphçš„æ™ºèƒ½èŠå¤©æœºå™¨äººï¼Œå…·æœ‰æ—¶é—´æ—…è¡ŒåŠŸèƒ½ã€äººå·¥ååŠ©æœºåˆ¶å’Œå·¥å…·é›†æˆèƒ½åŠ›ã€‚è¯¥é¡¹ç›®å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨LangGraphæ„å»ºå¤æ‚çš„å¯¹è¯ç³»ç»Ÿã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç”¨æˆ·è¾“å…¥      â”‚â”€â”€â”€â–¶â”‚   èŠå¤©æœºå™¨äºº     â”‚â”€â”€â”€â–¶â”‚    å·¥å…·èŠ‚ç‚¹     â”‚
â”‚   (HumanMessage)â”‚    â”‚   (chatbot)     â”‚    â”‚  (tool_node)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
                              â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   è·¯ç”±å†³ç­–      â”‚    â”‚   å·¥å…·æ‰§è¡Œ      â”‚
                       â”‚ (route_tool)    â”‚    â”‚   ç»“æœè¿”å›      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŠ¶æ€ç®¡ç†

```python
class State(TypedDict):
    messages: Annotated[List[dict], add_messages]
    name: str      # ç”¨æˆ·åç§°
    birthday: str  # ç”¨æˆ·ç”Ÿæ—¥
```

## ğŸ› ï¸ å·¥å…·é›†æˆ

### 1. æœç´¢å·¥å…·
- **å·¥å…·**: `TavilySearch`
- **åŠŸèƒ½**: ç½‘ç»œæœç´¢èƒ½åŠ›
- **é…ç½®**: æœ€å¤§ç»“æœæ•°ä¸º2

### 2. äººå·¥ååŠ©å·¥å…·
```python
@tool
def human_assistance(name: str, birthday: str, tool_call_id: str) -> str:
    """è¯·æ±‚äººå·¥ååŠ©çš„å·¥å…·"""
    # å®ç°äººå·¥éªŒè¯å’Œä¿®æ­£åŠŸèƒ½
```

**ç‰¹ç‚¹**:
- æ”¯æŒä¿¡æ¯éªŒè¯
- JSONæ ¼å¼è¾“å…¥/è¾“å‡º
- çŠ¶æ€æ›´æ–°æœºåˆ¶

### 3. æ—¶é—´æ—…è¡Œå·¥å…·

#### å†å²æŸ¥çœ‹
```python
@tool
def show_history(tool_call_id: str) -> str:
    """æ˜¾ç¤ºå¯¹è¯å†å²çŠ¶æ€å¿«ç…§"""
```

#### æ£€æŸ¥ç‚¹é€‰æ‹©
```python
@tool
def select_checkpoint(step_number: int, tool_call_id: str) -> str:
    """é€‰æ‹©è¦å›é€€åˆ°çš„æ£€æŸ¥ç‚¹"""
```

**åŠŸèƒ½**:
- æŸ¥çœ‹å®Œæ•´å¯¹è¯å†å²
- é€‰æ‹©ç‰¹å®šæ£€æŸ¥ç‚¹
- ä»æ£€æŸ¥ç‚¹æ¢å¤å¯¹è¯

## ğŸ”„ å·¥ä½œæµç¨‹

### 1. æ¶ˆæ¯å¤„ç†æµç¨‹
```
START â”€â”€â–¶ chatbot â”€â”€â–¶ route_tool â”€â”€â”
           â–²                       â”‚
           â”‚                       â–¼
        tools â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [åˆ¤æ–­æ˜¯å¦éœ€è¦å·¥å…·]
           â”‚                       â”‚
           â–¼                       â–¼
      [å·¥å…·æ‰§è¡Œ]                  END
```

### 2. è·¯ç”±å†³ç­–
```python
def route_tool(state: State):
    """è·¯ç”±å†³ç­–é€»è¾‘"""
    messages = state["messages"]
    last_message = messages[-1]
    
    if isinstance(last_message, AIMessage) and last_message.tool_calls:
        return "tools"  # éœ€è¦è°ƒç”¨å·¥å…·
    return "end"        # ç›´æ¥ç»“æŸ
```

## ğŸ’¾ æŒä¹…åŒ–å­˜å‚¨

### å†…å­˜æ£€æŸ¥ç‚¹
```python
memory = MemorySaver()
graph = graph_builder.compile(checkpointer=memory)
```

### é…ç½®ç®¡ç†
```python
config = {"configurable": {"thread_id": "1"}}
```

## ğŸ® äº¤äº’å¼å‘½ä»¤

### åŸºæœ¬å‘½ä»¤
| å‘½ä»¤ | ç®€å†™ | åŠŸèƒ½ |
|------|------|------|
| `history` | `h` | æ˜¾ç¤ºå¯¹è¯å†å² |
| `select <æ•°å­—>` | `s <æ•°å­—>` | é€‰æ‹©æ£€æŸ¥ç‚¹ |
| `continue` | `c` | ä»æ£€æŸ¥ç‚¹ç»§ç»­ |
| `exit/quit` | `q` | é€€å‡ºç¨‹åº |
| `help` | - | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

### ä½¿ç”¨ç¤ºä¾‹
```bash
User: æˆ‘çš„åå­—æ˜¯å¼ ä¸‰ï¼Œç”Ÿæ—¥æ˜¯1990-01-01
AI: ä½ å¥½å¼ ä¸‰ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ...

User: history
å¯¹è¯å†å²çŠ¶æ€ (æŒ‰æ—¶é—´é¡ºåº):
æ­¥éª¤ 0: 14:30:15 (ID: abc12345...) - åç§°: å¼ ä¸‰, ç”Ÿæ—¥: 1990-01-01

User: select 0
å·²é€‰æ‹©æ£€æŸ¥ç‚¹ 0 (ID: abc12345...) - åç§°: å¼ ä¸‰, ç”Ÿæ—¥: 1990-01-01

User: continue
ä»æ£€æŸ¥ç‚¹ç»§ç»­å¯¹è¯...
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
```python
os.environ["LANGCHAIN_TRACING_V2"] = "false"
os.environ["LANGCHAIN_API_KEY"] = ""
os.environ["DEEPSEEK_API_KEY"] = "your_api_key_here"
```

### LLMé…ç½®
```python
llm = ChatOpenAI(
    model="deepseek-chat",
    api_key=os.environ["DEEPSEEK_API_KEY"],
    base_url="https://api.deepseek.com/v1"
)
```

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### 1. çŠ¶æ€ç®¡ç†
- âœ… å¯¹è¯å†å²æŒä¹…åŒ–
- âœ… ç”¨æˆ·ä¿¡æ¯è·Ÿè¸ª
- âœ… æ£€æŸ¥ç‚¹æœºåˆ¶

### 2. å·¥å…·é›†æˆ
- âœ… ç½‘ç»œæœç´¢
- âœ… äººå·¥ååŠ©
- âœ… æ—¶é—´æ—…è¡Œ

### 3. äº¤äº’ä½“éªŒ
- âœ… æµå¼è¾“å‡º
- âœ… å‘½ä»¤è¡Œç•Œé¢
- âœ… é”™è¯¯å¤„ç†

## ğŸ“Š æ•°æ®æµ

### è¾“å…¥å¤„ç†
```
ç”¨æˆ·è¾“å…¥ â†’ HumanMessage â†’ State.messages â†’ LLMå¤„ç† â†’ AIMessage
```

### å·¥å…·è°ƒç”¨
```
AIMessage.tool_calls â†’ å·¥å…·æ‰§è¡Œ â†’ ToolMessage â†’ Stateæ›´æ–°
```

### çŠ¶æ€æ›´æ–°
```python
state_update = {
    "name": verified_name,
    "birthday": verified_birthday,
    "messages": [ToolMessage(response, tool_call_id=tool_call_id)],
}
```

## ğŸ› é”™è¯¯å¤„ç†

### å¼‚å¸¸æ•è·
```python
try:
    # æ ¸å¿ƒé€»è¾‘
except Exception as e:
    print(f"é”™è¯¯: {e}")
    continue
```

### è¾“å…¥éªŒè¯
```python
try:
    human_response = json.loads(raw_input)
except json.JSONDecodeError:
    print("è¾“å…¥æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚")
    return "Invalid input."
```

## ğŸ”® æ‰©å±•å»ºè®®

### 1. æ•°æ®åº“é›†æˆ
```python
# æ›¿æ¢MemorySaverä¸ºæŒä¹…åŒ–å­˜å‚¨
from langgraph.checkpoint.postgres import PostgresSaver
# æˆ–
from langgraph.checkpoint.sqlite import SqliteSaver
```

### 2. æ›´å¤šå·¥å…·
- æ–‡ä»¶æ“ä½œå·¥å…·
- é‚®ä»¶å‘é€å·¥å…·
- æ•°æ®åˆ†æå·¥å…·

### 3. å¢å¼ºåŠŸèƒ½
- ç”¨æˆ·è®¤è¯
- æƒé™ç®¡ç†
- å®¡è®¡æ—¥å¿—

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å†…å­˜ç®¡ç†
- å®šæœŸæ¸…ç†å†å²è®°å½•
- é™åˆ¶çŠ¶æ€å¤§å°

### 2. å¹¶å‘å¤„ç†
- å¼‚æ­¥å·¥å…·è°ƒç”¨
- çº¿ç¨‹æ± ç®¡ç†

### 3. ç¼“å­˜æœºåˆ¶
- æœç´¢ç»“æœç¼“å­˜
- çŠ¶æ€å¿«ç…§ç¼“å­˜

## ğŸ§ª æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•
```python
def test_chatbot_node():
    """æµ‹è¯•èŠå¤©æœºå™¨äººèŠ‚ç‚¹"""
    pass

def test_tool_routing():
    """æµ‹è¯•å·¥å…·è·¯ç”±é€»è¾‘"""
    pass
```

### é›†æˆæµ‹è¯•
```python
def test_full_workflow():
    """æµ‹è¯•å®Œæ•´å·¥ä½œæµç¨‹"""
    pass
```

## ğŸ“š å‚è€ƒèµ„æº

- [LangGraphå®˜æ–¹æ–‡æ¡£](https://langchain-ai.github.io/langgraph/)
- [LangChainå·¥å…·é›†æˆ](https://python.langchain.com/docs/integrations/tools/)
- [OpenAI APIæ–‡æ¡£](https://platform.openai.com/docs/api-reference)


## ğŸ“„ è®¸å¯è¯

è¯¥é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªå­¦ä¹ ç¤ºä¾‹é¡¹ç›®ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰è¯·è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’Œå®‰å…¨å®¡æŸ¥ã€‚